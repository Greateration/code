<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shopinfo page</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="js/myjQuery.js"></script>
    <script src="js/bootstrap.min.js"></script>
</head>

<body>
    <div class="header">
        <div class="container">
            <div class="welcome lf">
                <a href="index.html">æ¬¢è¿æ¥åˆ°å¦®è”»å•†åŸï¼</a>
            </div>
            <div class="userlogin lf">
                <a href="login.html" class="login">è¯·ç™»å½•</a>
                <a href="register.html" class="register">å…è´¹æ³¨å†Œ</a>
                <a href="#" class="exit" style="display: none;">é€€å‡ºç™»å½•</a>
            </div>
            <div class="usercenter rt">
                <a href="#">æˆ‘çš„å¦®è”»</a>
                <a href="cart.html">è´­ç‰©è½¦</a>
                <a href="#">æ”¶è—</a>
                <a href="#">å¸®åŠ©ä¸­å¿ƒ</a>
            </div>
        </div>
    </div>
    <div class="wrap">
        <div class="search-box container">
            <div class="search-title lf">
                <a href="index.html">å¦®è”»å•†åŸ</a>
            </div>
            <div class="search-logo lf visible-lg">
            </div>
            <div class="search-input">
                <input type="text" placeholder="è¯·è¾“å…¥å…³é”®å­—">
                <a href="#"><i></i></a>
            </div>
        </div>
        <div class="listbox">
            <div class="container">
                <ul class="lists">
                    <li class="list-btn">
                        <a href="#">
                            <img src="img/nav.png" class="listall"> å•†å“åˆ†ç±»
                        </a>
                        <div class="hiddenlist">
                            <a href="#">æŠ¢è´­/ä¿ƒé”€/ç‰¹å–</a>
                            <a href="#">ç”·è£…/ç”·å£«/å•†åŠ¡</a>
                            <a href="#">å¥³è£…/æ—¶å°š/åŒ–å¦†å“</a>
                            <a href="#">å¥¢ä¾ˆå“/æ•°ç </a>
                            <a href="#">ç”Ÿæ´»ç”¨å“/å±…å®¶å¸¸ç”¨</a>
                            <a href="#">è¿åŠ¨/è£…å¤‡</a>
                            <a href="#">ä¼‘é—²å¨±ä¹</a>
                            <a href="#">å®¶ç”¨ç”µå™¨</a>
                            <a href="#">æˆ·å¤–å¥èº«</a>
                        </div>
                    </li>
                    <li class="list-link linkone">
                        <a href="index.html">é¦–é¡µ</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="goods_details container">

        </div>
    </div>
    <div class="footer">
        <div class="container">
            <p>
                Copyright 2008-2020 niko.comï¼ŒAll Rights Reserved ICPè¯ï¼šæ·¦ B5-14283378
            </p>
        </div>
    </div>
    <!-- æ¨¡æ€æ¡†ç™»å½• -->
    <div id="loginModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <button class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-title">
                    <h1 class="text-center">ç™»å½•</h1>
                </div>
                <div class="modal-body">
                    <form class="form-group" action="">
                        <div class="form-group">
                            <label for="">ç”¨æˆ·å</label>
                            <input class="form-control" type="text" placeholder="">
                        </div>
                        <div class="form-group">
                            <label for="">å¯†ç </label>
                            <input class="form-control" type="password" placeholder="">
                        </div>
                        <div class="text-right">
                            <button class="btn btn-primary modallogin" type="submit">ç™»å½•</button>
                            <button class="btn btn-danger" data-dismiss="modal">å–æ¶ˆ</button>
                        </div>
                        <a href="" class="toreg" data-toggle="modal" data-dismiss="modal"
                            data-target="#registerModal">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç‚¹æˆ‘æ³¨å†Œ</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- æ¨¡æ€æ¡†æ³¨å†Œ -->
    <div id="registerModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <button class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-title">
                    <h1 class="text-center">æ³¨å†Œ</h1>
                </div>
                <div class="modal-body">
                    <form class="form-group" action="">
                        <div class="form-group">
                            <label for="">ç”¨æˆ·å</label>
                            <input class="form-control" type="text" placeholder="6-15ä½å­—æ¯æˆ–æ•°å­—">
                        </div>
                        <div class="form-group">
                            <label for="">å¯†ç </label>
                            <input class="form-control" type="password" placeholder="è‡³å°‘6ä½å­—æ¯æˆ–æ•°å­—">
                        </div>
                        <div class="form-group">
                            <label for="">å†æ¬¡è¾“å…¥å¯†ç </label>
                            <input class="form-control" type="password" placeholder="è‡³å°‘6ä½å­—æ¯æˆ–æ•°å­—">
                        </div>
                        <div class="form-group">
                            <label for="">é‚®ç®±</label>
                            <input class="form-control" type="email" placeholder="ä¾‹å¦‚:123@123.com">
                        </div>
                        <div class="text-right">
                            <button class="btn btn-primary" type="submit">æäº¤</button>
                            <button class="btn btn-danger" data-dismiss="modal">å–æ¶ˆ</button>
                        </div>
                        <a href="" data-toggle="modal" data-dismiss="modal" data-target="#loginModal">å·²æœ‰è´¦å·ï¼Ÿç‚¹æˆ‘ç™»å½•</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- åŠ å…¥è´­ç‰©è½¦ -->
    <div id="addModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <button class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-title">
                    <h1 class="text-center">å·²ç»åŠ å…¥è´­ç‰©è½¦ğŸ›’</h1>
                </div>
                <div class="modal-body">
                    <form class="form-group" action="">
                        <div class="text-center">
                            <button class="btn btn-primary modallogin" data-dismiss="modal">ç»§ç»­è´­ç‰©</button>
                            <button class="btn btn-danger entercart" data-dismiss="modal">è¿›å…¥è´­ç‰©è½¦</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    $(function () {
        var url = location.search;
        var userdata = {};
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            var arr = str.split("&");
            arr.forEach(function (item, index) {
                userdata[item.split("=")[0]] = item.split("=")[1];
            })
        }
        if (localStorage.token) {
            $(".login").html(userdata.username);
            $(".register").hide();
            $(".exit").show();
            $(".exit").click(function () {
                $(this).hide();
                $(".login").html("è¯·ç™»å½•");
                $(".register").show();
                localStorage.clear(); //æ¸…ç©ºæœ¬åœ°æ•°æ®
            })
        }
        $.ajax({
            url: "http://localhost/w/website/findGoodsTypeList",
            success: function (resu) {
                resu.data.forEach(function (item, index) {
                    $(".lists").append(
                        `<li class="list-link"><a href="#">${item.name}</a></li>`);
                })
                $(".lists a").click(function () {
                    if (userdata.username) {
                        location.href = "classify.html?shopname=" + encodeURIComponent($(
                                this)
                            .text()) + "&username=" + encodeURIComponent(userdata
                            .username);
                    } else {
                        location.href = "classify.html?shopname=" + encodeURIComponent($(
                                this)
                            .text());
                    }

                })
                // ç‚¹å‡»æŸåˆ†ç±» åˆ†ç±»é¡µæ˜¾ç¤ºè¯¥åˆ†ç±»ç‚¹äº®
                for (i = 0; i < $(".list-link a").length; i++) {
                    if ($(".list-link a")[i].innerText == decodeURIComponent(userdata.shopname)) {
                        $(".list-link a")[i].style.color = "#f10180";
                    }
                }
                //ç‚¹å‡»æŸåˆ†ç±» åˆ†ç±»é¡µæ˜¾ç¤ºè¯¥åˆ†ç±»çš„æ ‡é¢˜
                $(".goodsname").html(decodeURIComponent(userdata.shopname));
            }

        })
        $.ajax({
            url: "http://localhost/w/website/findGoodsDetail?info=" + userdata.id,
            success: function (resu) {
                var arr = resu.data.detail.tbk_item_info_get_response.results.n_tbk_item;
                $(".goods_details").append(`<div class="theshop cf">
                    <a href="#" class="shopimg"><img src="${arr[0].small_images.string[0]}">
                        <div class="anchor"></div>
                    </a>
                    <div class="bigbox">
                        <img src="${arr[0].small_images.string[0]}">
                    </div>
                    <div class="checkone">
                        <a class="selectone"><img src="${arr[0].small_images.string[0]}"></a>
                        <a class="selectone"><img src="${arr[0].small_images.string[1]}"></a>
                        <a class="selectone"><img src="${arr[0].small_images.string[2]}"></a>
                        <a class="selectone"><img src="${arr[0].small_images.string[3]}"></a>
                    </div>
                </div>
                <div class="details cf">
                    <div class="shopdesc">
                        <h4 class="shop_title">${arr[0].title}</h4>
                        <label><span>äº§å“åç§°ï¼š</span><small>${arr[0].cat_leaf_name}</small></label><br>
                        <label><span>äº§åœ°ï¼š</span><small>${arr[0].provcity}</small></label><br>
                        <label><span>å“ç±»ï¼š</span><small>${arr[0].cat_name}</small></label><br>
                        <label><span>åº—é“ºï¼š</span><small>${arr[0].nick}</small></label><br>
                        <br>
                    </div>
                    <div class="shopdetail cf">
                        <div>åŸä»·ï¼š<span></span></div>
                        <span class="price">ï¿¥${arr[0].reserve_price}</span>
                        <br>
                        <div>æŠ˜åä»·ï¼š<span></span></div>
                        <label class="dzprice">ï¿¥${arr[0].zk_final_price}</label>
                        <br>
                        <div>è´­ä¹°æ•°é‡ï¼š<span></span></div>
                        <div class="shopdetail_btn">
                            <button class="reduce">-</button>
                            <input type="text" value="1">
                            <button class="add">+</button>
                        </div>
                    </div>
                    <a class="buy" data-toggle="modal"
                            data-target="#loginModal">ç«‹å³è´­ä¹°</a>
                    <a class="addcart" data-toggle="modal"
                            data-target="#loginModal">åŠ å…¥è´­ç‰©è½¦</a>
                </div>`);
                $(".selectone img").mouseenter(function () {
                    $(this).css("border", "1px solid #f10180");
                })
                $(".selectone img").mouseleave(function () {
                    $(this).css("border", "none");
                })
                $(".selectone").click(function () {
                    var index = $(this).index();
                    $(".shopimg img").remove();
                    $(".shopimg").append(
                        `<img src="${arr[0].small_images.string[index]}">`);
                    $(".bigbox img").remove();
                    $(".bigbox").append(
                        `<img src="${arr[0].small_images.string[index]}">`);

                })
                // æ”¾å¤§é•œ
                var largelook = new MakeLarger();
                $(".add").click(function () {
                    var num = $(this).prev().val();
                    num++;
                    $(this).prev().val(num);
                    var str = $(".dzprice").text().substr(1);
                    var resa = (parseFloat(str) + parseFloat(arr[0].zk_final_price))
                        .toFixed(2);
                    $(".dzprice").text("ï¿¥" + resa);
                })
                $(".reduce").click(function () {
                    var num2 = $(this).next().val();
                    num2--;
                    if (num2 == 0) {
                        $(this).prop("disabled", true)
                    }
                    $(this).next().val(num2);
                    var str2 = $(".dzprice").text().substr(1);
                    var resd = (parseFloat(str2) - parseFloat(arr[0].zk_final_price))
                        .toFixed(2);
                    $(".dzprice").text("ï¿¥" + resd);
                })
                $(".shopdetail input").blur(function () {
                    if ($(this).val() < 0) {
                        alert("è¯·è¾“å…¥å¤§äº0çš„æ•°å­—");
                        $(this).val(0);
                    }
                    var thisnum = $(this).val();
                    var resthis = parseFloat(arr[0].zk_final_price) * thisnum;
                    $(".dzprice").text("ï¿¥" + resthis);
                })
                // $(".buy").click(function () {
                //     // åˆ¤æ–­ç”¨æˆ·ç™»å½•
                //     if (userdata.username) {

                //     } else {
                //         //æœªç™»å½•è§¦å‘æ¨¡æ€æ¡†ç™»å½•
                //         ajaxlogin();
                //     }
                // })
                $(".addcart").click(function () {
                    // åˆ¤æ–­ç”¨æˆ·ç™»å½•
                    if (localStorage.token) {
                        $(this).attr("data-target", "#addModal");
                        // åŠ è´­ç‰©è½¦
                        var k =
                            0; // å®šä¹‰ä¸€ä¸ªå‚æ•°ï¼Œç”¨åœ¨å¾ªç¯ä¸­è®¡ç®—æ˜¯å¦æœ‰è¿™ä¸ªå•†å“idï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±æŠŠå•†å“æ·»åŠ åˆ°giftsä¸­ï¼Œå¦‚æœæœ‰ï¼Œé‚£è¿™ä¸ªå•†å“çš„numå¢åŠ 
                        var gift = {
                            id: userdata.id,
                            shopprice: arr[0].zk_final_price,
                            shopnum: $(".shopdetail input").val(),
                            shopname: arr[0].title,
                            num: 1
                        };
                        var gifts = localStorage.getItem("gifts") ?
                            JSON.parse(localStorage.getItem("gifts")) : [];
                        for (var i = 0; i < gifts.length; i++) {
                            var item = gifts[i];
                            if (item.id === gift.id) {
                                item.num += gift.num;
                            } else {
                                k = k + 1;
                            }
                        }
                        if (k === gifts.length) {
                            gifts.push(gift);
                        }

                        localStorage.setItem("gifts", JSON.stringify(gifts));
                    } else {
                        $(this).attr("data-target", "#loginModal");
                        //æœªç™»å½•è§¦å‘æ¨¡æ€æ¡†ç™»å½•
                        ajaxlogin();
                    }
                })
                $(".entercart").click(function(){
                    location.href = "cart.html";
                })
            }

        })
        $(".list-btn").mouseenter(function () {
            $(".hiddenlist").stop().fadeIn();
        })
        $(".list-btn").mouseleave(function () {
            $(".hiddenlist").stop().fadeOut();
        })
        $(".hiddenlist").children().mouseenter(function () {
            $(this).css({
                "backgroundColor": "#fff",
                "color": "#f10180"
            });
        })
        $(".hiddenlist").children().mouseleave(function () {
            $(this).css({
                "backgroundColor": "#f10180",
                "color": "#fff"
            });
        })
    })
    //æ¨¡æ€æ¡†ç™»å½•æ–¹æ³•
    function ajaxlogin() {
        $("modallogin").click(function () {
            var namestr = $("input[name=uname]").val();
            var passstr = $("input[name=upass]").val();
            console.log(namestr);
            //ä½¿ç”¨ajaxæäº¤æ–¹æ³•
            //$.post("è¯·æ±‚çš„è·¯å¾„",{jsonå‚æ•°},åŒ¿åçš„å›è°ƒå‡½æ•°function(resuobj){});
            $.post("http://192.168.1.103:3000/users/login", {
                username: namestr,
                userpass: passstr
            }, function (resuobj) {
                //å›è°ƒå‡½æ•° 
                var jsonobj = JSON.stringify(resuobj);
                localStorage.token = jsonobj;
                // if (jsonobj.status == 0) {
                //     var loginUser = jsonobj.username;
                //     $(".login").html(loginUser);
                //     $(".register").hide();
                //     $(".exit").show();
                //     $(".exit").click(function () {
                //         $(this).hide();
                //         $(".login").html("è¯·ç™»å½•");
                //         $(".register").show();
                //         localStorage.clear(); //æ¸…ç©ºæœ¬åœ°æ•°æ®
                //     })
                //     $('#updateModal').modal('hide');
                // } else {

                // }
            });
        })

    }
    //æ”¾å¤§é•œæ„é€ æ–¹æ³•
    function MakeLarger() {
        //è·å–å±æ€§
        this.small = document.querySelector(".shopimg"); /*å°ç›’å­*/
        this.anchor = document.querySelector(".anchor"); /*ç§»åŠ¨é”šç‚¹*/
        this.large = document.querySelector(".bigbox"); /*å¤§ç›’å­*/
        this.largeimg = document.querySelector(".bigbox > img"); /*æ”¾å¤§é•œå›¾ç‰‡*/
        this.maxX = this.small.offsetWidth - this.anchor.offsetWidth; /*æ‰€èƒ½ç§»åŠ¨çš„æ°´å¹³æå€¼*/
        this.maxY = this.small.offsetHeight - this.anchor.offsetHeight; /*æ‰€èƒ½ç§»åŠ¨çš„æ°´å¹³æå€¼*/
        var _this = this; //thisæŒ‡å‘èµ‹ç»™å˜é‡
        //å°ç›’å­æ·»åŠ é¼ æ ‡äº‹ä»¶æ–¹æ³•
        this.smallMouse = function () {
            //é¼ æ ‡ç§»å…¥è§¦å‘
            _this.small.onmouseenter = function () {
                _this.large.style.display = "block";
                _this.anchor.style.display = "block";
                _this.anchor.style.opacity = 0.7;
            }
            //é¼ æ ‡ç§»å‡ºè§¦å‘
            _this.small.onmouseleave = function () {
                _this.large.style.display = "none";
                _this.anchor.style.display = "none";
            }
            //é¼ æ ‡ç§»åŠ¨è§¦å‘
            _this.small.onmousemove = function (e) {
                e = e || window.event; //å…¼å®¹IE
                /*æ°´å¹³ç§»åŠ¨è·ç¦»*/
                var left = e.clientX - _this.small.parentElement.offsetLeft - _this.anchor.offsetWidth / 2;
                left = left < 0 ? 0 : left;
                left = left > _this.maxX ? _this.maxX : left;
                _this.anchor.style.left = left + "px";
                /*å‚ç›´ç§»åŠ¨è·ç¦»*/
                var top = e.clientY - _this.small.offsetTop - _this.anchor.offsetHeight / 2;
                top = top < 0 ? 0 : top;
                top = top > _this.maxY ? _this.maxY : top;
                _this.anchor.style.top = top + "px";
                /*æ°´å¹³æ¯”ä¾‹*/
                var percentX = left / _this.maxX;
                /*å‚ç›´æ¯”ä¾‹*/
                var percentY = top / _this.maxY;
                /*å¤§å›¾ç§»åŠ¨è·ç¦»*/
                var bigLeft = (_this.largeimg.offsetWidth - _this.large.offsetWidth) * percentX;
                var bigTop = (_this.largeimg.offsetHeight - _this.large.offsetHeight) * percentY;
                _this.largeimg.style.left = -bigLeft + "px";
                _this.largeimg.style.top = -bigTop + "px";
            }
        }
        this.smallMouse(); //è°ƒç”¨é¼ æ ‡äº‹ä»¶æ–¹æ³•
    }
</script>

</html>